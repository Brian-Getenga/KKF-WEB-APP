{% extends 'base.html' %}
{% load static %}
{% block title %}Verify OTP | Kenya Karate Federation{% endblock %}

{% block content %}
<section class="min-h-screen flex items-center justify-center bg-[#525252] px-6 py-16">
  <div class="max-w-lg w-full bg-white rounded border-2 border-[#d6d3d1] p-8 md:p-10">
    
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="w-16 h-16 bg-[#FFCD00] rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        </svg>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold text-[#525252] mb-2">Check Your Email</h1>
      <p class="text-[#525252]">We've sent a verification code to</p>
      <p class="text-[#FFCD00] font-bold mt-1">{{ email }}</p>
    </div>

    <!-- Messages -->
    {% if messages %}
    <div class="mb-6">
      {% for message in messages %}
      <div class="p-4 rounded border-2 {% if message.tags == 'error' %}bg-red-50 border-[#fb2c36] text-[#fb2c36]{% elif message.tags == 'success' %}bg-green-50 border-[#7ccf00] text-[#7ccf00]{% else %}bg-blue-50 border-[#2b7fff] text-[#2b7fff]{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- OTP Verification Form -->
    <form method="post" class="space-y-6">
      {% csrf_token %}
      
      <!-- Hidden fields -->
      {{ form.email }}
      {{ form.purpose }}
      
      <!-- OTP Code Input -->
      <div>
        <label for="{{ form.otp_code.id_for_label }}" class="block text-[#525252] font-bold mb-2 text-center">
          Enter Verification Code
        </label>
        
        <!-- OTP Input with styling -->
        <div class="flex justify-center mb-2">
          <input 
            type="text" 
            name="otp_code" 
            id="{{ form.otp_code.id_for_label }}"
            placeholder="000000"
            maxlength="6"
            inputmode="numeric"
            pattern="[0-9]{6}"
            class="w-48 px-4 py-4 text-center text-2xl font-bold tracking-widest rounded border-2 border-[#d6d3d1] text-[#525252] focus:border-[#FFCD00] focus:outline-none transition-colors"
            required
            autofocus>
        </div>
        
        {% if form.otp_code.errors %}
          {% for error in form.otp_code.errors %}
          <p class="text-[#fb2c36] text-sm text-center mt-2">{{ error }}</p>
          {% endfor %}
        {% endif %}
        
        <p class="text-[#525252] text-sm text-center mt-2">
          {{ form.otp_code.help_text }}
        </p>
      </div>

      <!-- Info Box -->
      <div class="p-4 bg-[#f5f5f5] rounded border border-[#d6d3d1]">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-[#2b7fff] mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <div>
            <p class="text-[#525252] text-sm font-bold">Code expires in 10 minutes</p>
            <p class="text-[#525252] text-sm mt-1">
              Make sure to check your spam folder if you don't see the email in your inbox.
            </p>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <button 
        type="submit"
        class="w-full py-4 bg-[#FFCD00] text-black font-bold text-lg rounded hover:bg-[#FBBF24] transition-colors">
        Verify & Continue
      </button>
    </form>

    <!-- Resend Code -->
    <div class="mt-6 pt-6 border-t-2 border-[#d6d3d1]">
      <p class="text-center text-[#525252] mb-3">Didn't receive the code?</p>
      
      <form method="post" action="{% url 'accounts:resend_otp' %}" class="text-center">
        {% csrf_token %}
        <input type="hidden" name="email" value="{{ email }}">
        <input type="hidden" name="purpose" value="{{ purpose }}">
        
        <button 
          type="submit"
          class="inline-flex items-center gap-2 px-6 py-2 bg-white border-2 border-[#d6d3d1] text-[#525252] font-bold rounded hover:border-[#FFCD00] hover:text-[#FFCD00] transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          Resend Code
        </button>
      </form>
    </div>

    <!-- Back Link -->
    <div class="mt-6 text-center">
      <a href="{% if purpose == 'login' %}{% url 'accounts:login' %}{% else %}{% url 'accounts:signup' %}{% endif %}" 
         class="text-[#525252] hover:text-[#FFCD00] transition-colors text-sm">
        ‚Üê Back to {% if purpose == 'login' %}Login{% else %}Sign Up{% endif %}
      </a>
    </div>

    <!-- Security Notice -->
    <div class="mt-6 p-3 bg-yellow-50 border border-yellow-200 rounded">
      <p class="text-yellow-800 text-xs text-center">
        üîí For your security, never share this code with anyone. KKF staff will never ask for your verification code.
      </p>
    </div>
  </div>
</section>

<!-- Auto-focus script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const otpInput = document.getElementById('{{ form.otp_code.id_for_label }}');
    
    // Format input as user types
    otpInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
      e.target.value = value.slice(0, 6); // Limit to 6 digits
    });
    
    // Auto-submit when 6 digits are entered (optional)
    otpInput.addEventListener('input', function(e) {
      if (e.target.value.length === 6) {
        // Optionally auto-submit the form
        // e.target.form.submit();
      }
    });
  });
</script>
{% endblock %}