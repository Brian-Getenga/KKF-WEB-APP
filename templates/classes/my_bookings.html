{% extends 'base.html' %}
{% load static %}

{% block title %}My Bookings | Kenya Karate Federation{% endblock %}

{% block content %}

<!-- Hero Section -->
<section class="relative h-[400px] bg-[#525252] flex items-center justify-center overflow-hidden">
    <img src="{% static 'images/booking_hero.jpg' %}" alt="My Bookings" 
         class="absolute w-full h-full object-cover opacity-30">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative z-10 text-center px-6 max-w-4xl mx-auto">
        <h1 class="text-5xl md:text-7xl font-black text-white mb-6 leading-tight">
            My <span class="text-[#FFCD00]">Bookings</span>
        </h1>
        <div class="w-24 h-1 bg-[#FFCD00] mx-auto mb-6"></div>
        <p class="text-xl text-[#d6d3d1]">
            View and manage all your current and past karate class bookings
        </p>
    </div>
</section>

<!-- Main Content -->
<section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-6">

        <!-- Results Count / Summary -->
        <div class="mb-8">
            <p class="text-[#525252] text-lg">
                You have <strong>{{ bookings.count }}</strong> booking{{ bookings.count|pluralize }}
                {% if active_bookings or pending_bookings %}
                    (<strong>{{ active_bookings.count|add:pending_bookings.count }}</strong> active)
                {% endif %}
            </p>
        </div>

        {% if has_any_booking %}

            <!-- Quick Stats Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
                <!-- Active Bookings -->
                <div class="bg-white rounded border-2 border-[#d6d3d1] p-8 text-center">
                    <div class="w-16 h-16 bg-[#FFCD00] rounded-xl mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-black" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p class="text-4xl font-black text-[#FFCD00]">{{ active_bookings.count|add:pending_bookings.count }}</p>
                    <p class="text-[#525252] font-bold mt-2">Active Bookings</p>
                </div>

                <!-- Total Bookings -->
                <div class="bg-white rounded border-2 border-[#d6d3d1] p-8 text-center">
                    <div class="w-16 h-16 bg-[#7ccf00] rounded-xl mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p class="text-4xl font-black text-[#7ccf00]">{{ bookings.count }}</p>
                    <p class="text-[#525252] font-bold mt-2">Total Bookings</p>
                </div>

                <!-- Total Spent -->
                <div class="bg-white rounded border-2 border-[#d6d3d1] p-8 text-center">
                    <div class="w-16 h-16 bg-[#525252] rounded-xl mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-[#FFCD00]" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2v6a2 2 0 002 2h12a2 2 0 002-2v-6a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 2h12v4H6V6zm0 8h12v4H6v-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p class="text-4xl font-black text-[#525252]">KES {{ total_spent|default:"0" }}</p>
                    <p class="text-[#525252] font-bold mt-2">Total Spent</p>
                </div>

                <!-- Member Since -->
                <div class="bg-white rounded border-2 border-[#d6d3d1] p-8 text-center">
                    <div class="w-16 h-16 bg-[#2b7fff] rounded-xl mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p class="text-4xl font-black text-[#2b7fff]">{% now "Y" %}</p>
                    <p class="text-[#525252] font-bold mt-2">Member Since</p>
                </div>
            </div>

            <!-- Pending Bookings -->
            {% if pending_bookings %}
                <div class="mb-12">
                    <h2 class="text-4xl font-black text-[#525252] mb-8 pb-4 border-b-4 border-[#FFCD00]">
                        Pending Payment
                    </h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {% for booking in pending_bookings %}
                            {% include "classes/booking_card.html" with booking=booking show_actions=True %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- Active Bookings -->
            {% if active_bookings %}
                <div class="mb-12">
                    <h2 class="text-4xl font-black text-[#525252] mb-8 pb-4 border-b-4 border-[#7ccf00]">
                        Active Bookings
                    </h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {% for booking in active_bookings %}
                            {% include "classes/booking_card.html" with booking=booking %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- Past Bookings -->
            {% if past_bookings %}
                <details class="bg-white rounded border-2 border-[#d6d3d1] p-8">
                    <summary class="text-2xl font-bold text-[#525252] cursor-pointer list-none">
                        Past / Cancelled Bookings ({{ past_bookings.count }})
                    </summary>
                    <div class="mt-8 pt-8 border-t-2 border-[#d6d3d1] grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {% for booking in past_bookings %}
                            {% include "classes/booking_card.html" with booking=booking is_past=True %}
                        {% endfor %}
                    </div>
                </details>
            {% endif %}

        {% else %}
            <!-- Empty State -->
            <div class="col-span-full text-center py-20">
                <svg class="w-20 h-20 mx-auto text-[#d6d3d1] mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <p class="text-[#525252] text-xl font-semibold mb-2">No bookings found</p>
                <p class="text-[#525252] mb-6">Start your journey by exploring our classes</p>
                <a href="{% url 'classes:class_list' %}" class="px-6 py-3 bg-[#FFCD00] text-black font-bold rounded hover:bg-[#FBBF24] transition-colors">
                    Browse Classes
                </a>
            </div>
        {% endif %}
    </div>
</section>

<!-- CTA Section -->
<section class="py-20 bg-[#f5f5f4]">
    <div class="max-w-4xl mx-auto px-6 text-center">
        <h2 class="text-4xl md:text-5xl font-black text-black mb-6">
            Ready for Your Next Class?
        </h2>
        <div class="w-24 h-1 bg-[#FFCD00] mx-auto mb-6"></div>
        <p class="text-black text-lg mb-10">
            Explore more classes and continue your training journey
        </p>
        <a href="{% url 'classes:class_list' %}" 
           class="inline-block px-10 py-5 bg-[#FFCD00] text-black font-black text-xl rounded uppercase tracking-wider hover:bg-[#FBBF24] transition-colors">
            Browse All Classes
        </a>
    </div>
</section>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

{% endblock %}